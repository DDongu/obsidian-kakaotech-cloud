---
sticker: emoji//270d-fe0f
---
WAF: Layer7에 설정하는 방화벽으로 사용자단에 가깝게 설정하는 방화벽
클라우드 보안을 구축하는 과정
- 구축 -> 운영으로 넘어가기 전에, 클라우드에서 최저 사양으로 개발환경을 맞추고 퍼퍼몬스 test를 하는데, 이때 보안솔루션을 같이 설정한다.

# 1. 정보보안의 정의
```
기밀성: 엿듣는 것을 방지 
무결성: 데이터 변조 방지
가용성: 서비스를 24\*265 가동 가능
```
#### 기밀성
-> 인가되지 않은 사용자가 정보를 보지 못하게 하는 모든 작작업
ex) 암호화 작업

#### 무결성
-> 정확하고 완저한 정보 유지에 필요한 모든 작업을 말함
- 누군가 정보를 고의로 훼손하거나 중간에 특정 이유로 변경이 가해졌을 때, 그것을 파악해 잘못된 정보가 전달되거나 유지되지 못하게 하는 것
ex)  MD5, SHA와 같은 해시 함수를 이용하여 변경 여부를 파악하는 것

#### 가용성
-> 정보가 필요할 떄, 접근을 허락하는 일련의 작업
- 우리가 유지하는 정보에 대해 사고날 염려 없이 온전한 상태를 유지하는 것이 정보보안이므로, 어떤 이유에서라도 그 정보를 사용할 수 없는 상황이라면 정보 보안에 실패한 것

## 2. 네트워크의 정보 보안
-> 데이터는 송수신하는 도중에 정보의 훼손, 변조, 유출을 막기 위한 관리적, 기술적 방법

- 네트워크 보안의 **1차 목표**: 정보를 가진 시스템을 공격해 유출하거나 사용하지 못하게 하거나 시스템이 동작하지 못하게 해 정보 서비스를 정상적으로 구동할 수 없게 만드는 행위를 네트워크에서 적절히 막는 것
- 네트워크 보안의 **2차 목표**: 정보가 네트워크를 통해 복제, 이동되는 유출을 막는 것
- 네트워크 보안이 잘 갖춰져 있다면, 어플리케이션에 취약점이 있는 상태에서도 1차 방어선이 되어 공격을 방어할 수 있음

- `트러스트 네트워크`: 보호받아야 할 네트워크
- `언트러스트 네트워크`: 신뢰할 수 없는 외부 네트워크를 
- 두 네트워크 사이에 방화벽 등의 보안조치를 함
- `DMZ 네트워크`: 운영하는 내부 네트워크이지만 신뢰할 수 없는 외부 사용자에게 개방해야하는 서비스 네트워크(일반적으로 인터넷에 공개되는 서비스를 배치)
	- `인터넷 시큐어 게이트웨이`: *트러스트 -> 언트러스트* 네트워크로 통신을 통제
	ex) 방화벽, SWG, 웹 필터, 어플리케이션 컨트롤, 샌드박스와 같은 서비스나 네트워크 장비
	- `데이터 센터 시큐어 게이트웨이` : *언트러스트 -> 트러스트* 네트워크로 통신을 통제
	ex) 방화벽, IPS, DCSG, WAF, Anti-DDoS 등의 장비

- 화이트리스트
	-> IP와 통신 정보에 대해 명확히 아는 경우에 사용
	ex) DB 같은데 사용(접근하는 IP가 정해져있으니까)
- 블랙리스트
	-> 네트워크 장비(IPS, 안티바이러스, WAF)는 일반적으로 블랙리스트 기반의 방어 기법을 제공

- 정탐, 오탐, 미탐(탐지 에러 타입)
	->요새는 AI를 사용하여 탐지를 함
	![[Pasted image 20250206131057.png]]
# 3. 네트워크 보안 장비
##  3.1. DDoS 방어 장비
- 데이터 센터 네트워크 내부와 외부의 경계에서 공격을 방어하는데, 이것은 볼류메트릭 공격을 우선 막기 위해서임
- 회선을 공급해주는 ISP나 네트워크 ISP와 연결되는 데이터 센터 네트워크의 가장 바깥쪽에 위치시켜 이 공격을 완화해야 함
- `트래픽 프로파일링 기법`을 주로 사용
	-> 네트워크 트래픽을 분석하여 특정한 네트워크 활동을 식별하는 기법
- 클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방비를 사내에 설치하는 방법이 있음
- *DDoS 탐지 장비*와 *방어 장비*를 구분하는 경우가 많음

![[Pasted image 20250206113451.png]]

## 3.2. 방화벽
-> 4계층에서 동작하는 패킷 필터링 장비
- 일반적으로 DDoS 방어 장비 바로 뒤에 놓음
- 3,4계층에서 동작하여 다른 보안 장비보다 비교적 간단히 동작하고 성능 우수
- 패킷에서 5-튜블 조건을 참고함
	- 5-튜블: 3,4계층 헤더의 Source IP, Destination IP, Protocol No, Source Post, Destination Port
- 헤더를 보고 판단하기 때문에 헤더를 조작하면 쉽게 공격할 수 있음. 그래서 현대에는 SPI 엔진을 사용한 방화벽을 사용함.

### 3.2.1. SPI 엔진
-> 초기 방화벽은 패킷 필터를 사용하여 단순히 패킷이 조건이 맞는지만 확인했는데, 이렇게 하니까  불특정 다수와 통신할 때 정책관리가 힘들었음.(특히 통신의 양방향성을 인지못함)
-> 따라서 요즘 방화벽에서는 SPI 엔진으로 통해 `상태 기반 패킷 검사` 기술을 사용.
	-> 패킷을 개별적으로 검사하는 대신 연결의 상태 정보를 유지하면서 패킷을 분석

![[Pasted image 20250206135219.png]]
```
🧐 동작 방식 ⬆️⬆️
1) 장비에 패킷이 들어오면 우선 세션 상태 테이블을 확인
2) 조건에 맞는 세션 정보가 세션 테이블에 있을 때, 포워딩 테이블을 확인(라우팅, ARP 포함)
3) 조건에 맞는 세션 정보가 세션 테이블에 없을 때, 방화벽 정책을 확인
4) 방화벽 정책은 맨 위의 정책부터 확인해 최종 정책까지 확인한 후 없을 때 암시적인 거부(Implicit) 규칙을 참고해 차단
5) 허용 규칙이 있으면 내용을 세션 테이블에 적어 넣음
6) 포워딩 테이블을 확인(라우팅, ARP 포함)
7) 조건에 맞는 정보가 포워딩 테이블에 있을 때, 적절한 인터페이스로 패킷을 포워딩(패킷을 목적지로 넘긴다는 말)
8) 조건에 맞는 정보가 포워딩 테이블에 없을 때, 패킷을 폐기
```

## 3.4. IPS, IDS
-> `IDS(침입 탐지 시스템)`: 방어보다 탐지에 초점을 맞추어 개발됨
-> `IPS(침입 방지 시스템)`: 공격이 발견되면 직접 차단하는 능력을 갖춘 장비
- 최근에는 IDS와 IPS 장비를 구분하지 않고 IPS로 통칭
- IDS와 IPS는 공격 데이터베이스를 제조사나 위협 인텔리전스 서비스 업체로부터 받음
- 방화벽은 3,4계층에서만 방어가 가능하지만, IDS와 IPS는 3계층~7계층까지 방어 가능
- **세션 이해 가능 여부**(회피 공격 차단을 위함), **어노말리**(능동적 방어를 위함) 등 가양한 기능으로 구분됨

### 3.4.1. HIPS(호스트 기반 IPS) vs NIPS(네트워크 기반 IPS)
- 일반적인 IPS의 종류는 NIPS
- 클라우드 네트워크의 여러 제약사항 때문에 NIPS 배포가 어려워 HIPS 사용 빈도가 늘었음
- 하지만, 서비스와 리소스 공유, 장애 발생 시 장애 주체 파악의 어려움 등의 이유로 클라우드 내부에서도 NIPS로 바뀌는 추세임
- IPS의 방어 방식: 패턴 매칭 방식(공격 데이터베이스 Signature 사용), 프로토콜 어노말리, 프로파일 어노말리

	1) 패턴 매칭 방식 방어 (**블랙리스트 방식**)
	-> 공격 패턴을 파악하여 DB에 담아 대응하는 `시그니처(Sigature) 방식(= 데이터베이스 방식 방어)`
	- 최신 공격 방식을 공격 DB에 신속히 반영하는게 중요
	1) 프로파일 어노말리 방어 (**화이트리스트 방식**)
		- 기준과 다른 행위가 일어나면 공격으로 판단함
			ex) 프린트 서버에 FTP 패킷이 전송되는 경우
			ex) 평소 1MB 이하의 트래픽이 발생하던 시스템에서 수십 MB 이상의 트래픽이 발생한 경우 등
		- 웜의 경우 패턴이 조심 변하지만 다량의 트래픽을 발생시키는 특징이 있기 때문에 패턴 매칭 방식에 비해 훨씬 잘 잡음
		- 향후 동적 프로파일 기능이 강화되면서 향후 *DDoS 방어 장비로 진화*
	2) 프로토콜 어노말리 방어 (**화이트리스트 방식**)
		- 해커가 외부에서 내부 네트워크에 접근이 어려워지자 내부 네트워크의 사용자가 악성 코드를 다운받게 만들어 침투하게 되었음.
		- 이때 좀비 PC가 되기 때문에 원래 사용되어야 하는 프로토콜이 아닌 다른 프로토콜을 사용하는 경우가 많음.
		- 이를 인지해 적절히 패킷을 제어하는 기법이 프로토콜 어노말리 기법임
			-> 정리) **서비스에서 사용되어야 하는 프로토콜과 다른 프로토콜을 사용할 때 이를 인식하여 패킷을 제어하는 기법**

### 3.4.2. IPS, IDS의 한계와 극복
![[Pasted image 20250206144332.png]]


## 3.5. VPN
-> 가상 네트워크를 만들어주는 장비로 공통 네트워크를 통해 데이터를 주고 받으면서도 안전하게 통신할 수 있게 함.
- `암호화`와 `터널링 기술`을 사용
- 본사 - 지사 네트워크 연결 -> IPSEC VPN 기술 사용 
	- 네트워크 간 연결은 보안이 강력한 IPSEC 기반의 VPN 기술 사용
	- 따라서 본사와 지사 모두 IPSEC VPN 기능을 지원하는 네트워크 장비가 필요
- 개인사용자 - 본사 -> SSL VPN 기술 사용

- `IPSEC VPN`: IP 계층(**네트워크 계층**)에서 동작하며, 모든 네트워크 트래픽을 암호화하고 보호
- `SSL VPN`:  TLS/SSL 계층(**어플리케이션 계층**)에서 동작하며, 웹 브라우저 기반으로 특정 어플리케이션 트래픽을 보호

#### 전용 회선에서 사용하는 VPN

![[Pasted image 20250206213031.png]]
=> 아래와 같이 각 서버를 종단 간에 직접 연결하는 경우, 회선 자체에는 데이터가 평문으로 흐르기 때문에 보안상 문제가 생길 수 있음. 따라서 VPN을 추가로 구성하여 데이터를 암호화 함.

### 3.5.1. VPN 동작 방식
- 가상 네트워크를 만들어주는 장비로 터널링 기법을 사용
- 터널링 기법: 터널링 프로토콜을 이용하여 패킷을 캡슐화하여 통신하는 기법

**VPN이 구현되는 3가지 형태**
1. Host to Host 통신 보호
	-> 두 호스트 간에 직접 VPN 터널을 연동하는 기법
	- VPN 구성으로 잘 사용하지 않음
2. Network to Network 통신 보호
	-> 본사-지사 같은 특정 네트워크를 가진 두 종단을 연결하는 경우
	- **IPSEC 프로토콜** 스택이 가장 多
3. Host가 Network로 접근할 때 보호
	-> 모바일 사용자가 일반 인터넷망을 통해 사내망으로 연결하는 겨우
	- **IPSEC**과 **SSL 프로토콜**이 범용적으로 사용

#### 회피 공격
-> 보안 장비나 보안 프로그램을 우회해 공격의 타깃에서 동작하여 공격하는 방법
- 대표적으로 `우회기법`이 있음
	- `우회 기법`은 보안 장비의 종류에 따라 달리지고 특정 회사의 특정 보안체계를 회피하기 위한 특별한 공격
- 대부분의 보안 장비가 네트워크 중간에서 공격 여부를 판단하므로 피해자의 입장과 동일한 환경과 상태에서 패킷을 점검하지 못하기 때문
- 회피 공격 중에 우회 공격이 가장 흔하며, 집중적인 타긱이 되어온 장비는 *IPS* 임

	⚔️ 공격예시
	![[Pasted image 20250206215222.png]]

