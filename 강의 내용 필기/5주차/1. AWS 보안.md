---
sticker: emoji//270d-fe0f
---
# AWS 보안
## IAM 권한
###### 권한을 갖는 대상
- IAM 사용자, 그룹 또는 역할(Identity based Policy)
	- 정책을 부여
- AWS 리소스(Resource based Policy)
		- S3의 Bucket과 같은 리소스에 직접 정책을 설정 가능
		- 역할을 부여

###### 최종 권한
1. 자격증명 기반 정책에서 허용(Allow)하는 권한
2. 리소스 기반 정책에서 허용하는 권한
-> 둘 중 하나라도 *명시적 거부*가 있을 경우에는 접근 불가(deny의 우선순위가 더 높음)

# AWS 네트워크
## ENI(Elastic Network Interface)
- 물리컴퓨터에서는 NIC에 IP를 할당하여 컴퓨터 간의 통신을 하게 됨
- AWS는 `ENI`를 통해 NIC를 가상으로 연결
- 서브넷의 IP 대역 중 하나가 *EC2 인스턴스의 ENI*에 **할당**되면서 네트워크에 연결(Elastic IP와는 별도) (인스턴스 생성 시 자동 생성되며 해제 불가)
```
💡LB를 DNS명으로 외부에서 nslookup으로 보면 공인 IP 2개가 확인됨
- 하나는 공인 IP이고 하나는 사설 IP로 Health Check에 사용됨
- Warming up 기능: 로드 밸런서가 트래픽 급증에 대비하여 내부적으로 준비하는 과정
  -> 해당 기능을 사용하면 IP가 10개까지도 증가하여, 들어오는 트래픽을 분산 시킬 수 있음
```

## Public Subnet과 Private Subnet
`Public Subnet`: 라우팅 테이블을 통해 인터넷 게이트웨이(**IGW**)와 *연결된* 서브넷
`Private Subnet`: 라우팅 테이블을 통해 인터넷 게이트웨이(**IGW**)와 *연결되지 않은* 서브넷
```
❓왜 프라이빗 서브넷이 필요한가?
인터넷에 연결된 장치는 항상 공격의 대상이 되기 때문에, 인터넷에 연결되지 않아도 되는 서버는 가급적 격리된 곳에 위치하는 것이 보안 원칙임
```

- 서브넷을 구축할 때는 고가용성을 확보하기 위해 2개 이상의  availability를 둬야됨
- AWS에서는 같은 가용영역이면 서브넷이 달라도 비용 X
- 하지만 다른 가용영역 간의 통신은 데이터 전송량에 따라 비용이 발생(인바운드는 요금 X, 아웃바운드만 요금 O

## 인터넷
- 한 컴퓨터 안에서 어플리케이션을 구분하기 위해서는 PORT를 기준으로 구분함
- NAT 게이트웨이를 둬서, 공유기의 NAT Table 을 통해 공유기와 연결된 장치들이 인터넷과 통신할 수 있게 함(이때 NAT 게이트웨이는 Public Subnet에 있어야 인터넷과 통신 가능)

~~Client -> -> IGW -> LB ->  NAT gateway -> Server~~

## 보안 그룹(Security Group)
- 특정 EC2 인스턴스에 접근할 수 있는 네트워크 대역을 한정하여 공격 위험성을 제거하는데, 이때 보안 그룹을 활용하면 좋음
- 보안그룹을 통해 아웃바운드/인바운드 규칙을 통해 들어오고 나가는 트래픽을 제어(방화벽 역할)

## NACL(Network ACL)
*\* ACL(Access Control List)* 
NACL을 통해 특정 서브넷에 위치한 모든 EC2 인스턴스에 대해 접근 가능한 네트워크 영역을 제한

- VPC를 생성하면 기본 NACL이 생성되어 있으며, 모든 서브넷이 해당 NACL을 사용하도록 설정됨
- NACL 생성 시 기본적으로 인/아웃 모두 0.0.0.0/0에 대한 거부가 설정되어 있으며 제거 불가(이때 규칙번호에 따라 우선순위가 있어 설정이 겹쳐도 낮은 규칙번호의 설정으로 적용)

# RDS
- AWS에서 제공하는 PaaS 모델
- MySQL, PostgreSQL, MariaDB, Oracle, SQL Server와 같은 여러 엔진 지원
- failover 기능을 제공
	**failover**: 장애가 발생했을 때 예비 시스템으로 자동 전환되는 기능
- IOPS에 제한을 둠 
	ex) gp2, gp3 등
- DB가 설치된 RDS 전용 가상서버(EC2와 동일)를 특정 서브넷에 생성

##### Multi-AZ
서로 다른 가용영역(AZ)에 RDS 인스턴스를 배치하여, 특정 가용영역에 문제가 발생하더라도 서비스를 다른 RDS 인스턴스를 바라보게 하여 **고가용성**을 확보하는 방법
- failover가 발생 시 마스터 노드가 바뀌게 된다면 이에 연결된 워커노드의 연결이 끊기게 된다. 따라서 초기 설정 시 어플리케이션과 aws 설정을 통해서 failover가 일어나도 서비스가 정상적으로 동작할 수 있게 설정해야 한다.

#### Aurora 서비스(RDS와 다른, AWS에서 만든 DB엔진)
- Write DB, Read DB가 있음
- DB를 읽을 일이 더 많기 때문에 ReadDB를 확장하는 방식으로 가용성을 높임
- 여분의 DB를 사용할 때 DB들을 클러스터링 해줘야 됨
- IOPS 설정을 신경쓰지 않아도 됨


# ELB

#### Scale Up vs Scale Out
**Scale Up**: ec2의 타입을 변경하는 것과 같음
**Scale Out**: ec2 인스턴스의 개수를 늘리는 것과 같음
- 로드밸런싱과 함께 활용

## 로드 밸런싱 방식
### Round Robin
: 로드 밸런서에서 서버를 순차적으로 선택하는 방법

### Hash
### Least Connection
### 응답 시간

# ELB 유형
1. ALB
2. NLB
3. CLB

## ELB 옵션
1. **인터넷 트래픽용**
- 인터넷을 통해 ELB에 접근하는 경우
- Public IP에서 접근할 떄
- 단, ELB가 Private IP:Public IP 쌍을 가지므로, Private IP 클라이언트에서도 사용 가능

2. **내부 네트워크 트래픽용**
- 내부 네트워크에서 ELB에 접근하는 경우
- Private IP에서 접근할 떄
- 주로 전용선을 통해 인터넷을 거치지 않고 VPC에 연결되는 경우 OR VPN을 통해 Priavte ip로 통신할 때 사용

## ELB 동작 특징
1. 상태 확인(Health Check) 서비스
- ELB에서 연결할 서버들의 상태를 상시 체크
- 비정상 상태의 서버로 트래픽을 전달하지 않음
- ELB에서 서버 측에 요청을 전달해서 응답을 받음으로써 처리되므로, 서버의 보안그룹에서 해당 요청을 받을 수 있도륵 지정된 포트에 대해 접근을 허용해야 함

2. 고가용성 지원
- ELB를 서로 다른 가용 영역에 해당하는 서브넷에 생성
- 특정 가용 영역에 문제가 생겨도 다른 가용 영역의 ELB가 트래픽을 처리

# Auto Scaling
`자동 확장 그룹`
- 확장/축소에 사용된 EC2 인스턴스의 논리적 집합

### 인스턴스 개수 조정 옵션
1. 항상 지정된 수의 인스턴스 유지: 자동 확장 그룹에서 지정한 인스턴스 개수를 유지
2. 수동 조정ㅣ 사용자가 직접 그룹의 인스턴스 개수를 조정
3. 일정 기반 조정: 특정 시간대에만 인스턴스를 확장
4. 온디맨드 기반 조정: EC2 지표(Metric)을 기반을 조정

# Lambda
: 코드를 통해 서버 없이 어플리케이션과 서비스를 구축 및 실행할 수 있는 서비스
![Pasted image 20250306114851](images/Pasted%20image%2020250306114851.png)

- 리전당 제한
	- 동시에 실행가능한 함수 개수
	- 함수를 저장하기 위한 스토리지 공간
- 개별 함수에 대한 제한
	- 함수 제한 시간 = 15분
- 그 외에도 여러 가지 제약사항들이 존재


ex) ![Pasted image 20250306115153](images/Pasted%20image%2020250306115153.png)
